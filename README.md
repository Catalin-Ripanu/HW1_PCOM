# HW1_PCOM

A Project in which I've implemented the Data Plane of a router in C++ using ISO/OSI network and data layers concepts.

## General Overview:
At each iteration, a new packet is obtained, all headers from the received packet are parsed, and depending on the packet type, a certain branch is chosen.

On the first day, I implemented the basic protocols (IPv4, ICMP). The other days were dedicated to the ARP protocol (the most demanding) and the routing process.

Within the loop in the main function, messages are received on any interface of the router as they come in, processed, and response packets or the same packets routed on the path chosen by the router are transmitted further. Also, here it's checked if there are messages received by the router and not yet routed that are in the queue, checking if they can be sent following the receipt of an ARP response.

## Implementation Details:

### Main Function() -> Condition 1
Here, ARP requests and ARP responses received by the router are processed, and ARP requests can also be constructed as needed. In this area is the ARP queue for routing messages for which we don't yet know the MAC address corresponding to the IP address of the next "hop". For the ARP queue, I used 'queue' from C++.

Also, a send_arp_p function is used to construct and send a new ARP packet (using known information, such as spa, tpa, etc).

### Main Function() -> Condition 2.1
Here, ICMP responses are constructed that the router sends if problems occur with IPv4 packets or if we receive an ICMP echo request.

### Main Function() -> Condition 2.2
Here, received IPv4 packets are processed to determine what will happen to them. It's checked if there's any problem with the received packet (incorrect version, transmission errors, insufficient TTL), generating an ICMP response if necessary. It's checked if the packet is destined for the router itself. If not, then the routing process continues, in which the routing table is searched for the packet's destination address. If a "hop" is not found, an ICMP response is generated and sent back to the source. If a "hop" is found, but we don't know its MAC address corresponding to the IP address, then the message is inserted into the ARP queue to be routed later, after we receive an ARP response (and ICMP responses generated by the router are subject to this process). If all information is available, the packet is routed on the spot. Updating the TTL for a routed packet is performed using the incremental checksum calculation algorithm.

Obviously, the stages of the routing process are rigorously stated in the assignment statement. The routing table search algorithm is performed in logarithmic complexity O(logn) because the table is already sorted within the 'init_route_table' initialization function (binary search is used).

Calculating the checksum after decrementing the TTL using the incremental algorithm from RFC 1624 is in the ip_checksum_bonus function.

The equation is simple:
HC' = HC - ~m - m'
HC  old checksum
HC' new checksum

There were some problems with implementing binary search / Trie search (I didn't insist on this variant anymore). I solved the first problem by changing the logic of the search algorithm.
